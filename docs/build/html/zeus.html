
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>zeus module &#8212; CMCC-Applications 0.1 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="zapata.work_in_progress module" href="zapata.work_in_progress.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="zapata.work_in_progress.html" title="zapata.work_in_progress module"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CMCC-Applications 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="modules.html" accesskey="U">Zapata</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">zeus module</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-zeus">
<span id="zeus-module"></span><h1>zeus module<a class="headerlink" href="#module-zeus" title="Permalink to this headline">¶</a></h1>
<p>Zeus utility functions</p>
<p>This Python module provides some basic utility functions to interact with
the Zeus SuperComputer at CMCC. It manages file upload and download,
submission of scripts on LSF, execution of general bash commands and creation
and shutdown of Dask clusters.</p>
<p>The module has been tested with Python 3.6, but it should work with most
Python 3 versions. It requires IPython, ipywidgets, dask and distributed
modules; to install the dependencies run for example:</p>
<blockquote>
<div><p>pip3 install IPython ipywidgets dask==2.12.0 distributed==2.12.0</p>
</div></blockquote>
<p>Import the module using:</p>
<blockquote>
<div><p>import zeus</p>
</div></blockquote>
<p>Before calling any other function from this module run the <cite>init</cite> function.</p>
<dl class="py function">
<dt id="zeus.init">
<code class="sig-prename descclassname">zeus.</code><code class="sig-name descname">init</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">user</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/zeus.html#init"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zeus.init" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the module with the Zeus login username.</p>
<p>It inizializes the module and checks if the ssh connection can be made.
This function must be called before any other function from the module.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>user</strong> (<em>str</em>) – Username on Zeus.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">zeus</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="zeus.execute">
<code class="sig-prename descclassname">zeus.</code><code class="sig-name descname">execute</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cmd</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/zeus.html#execute"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zeus.execute" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute a command remotely on Zeus.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>cmd</strong> (<em>str</em>) – Command to be executed on Zeus.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">zeus</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;ls ~/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="zeus.get">
<code class="sig-prename descclassname">zeus.</code><code class="sig-name descname">get</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">src</span></em>, <em class="sig-param"><span class="n">dst</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/zeus.html#get"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zeus.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Download a file from Zeus.</p>
<p>Copy remote file specified in <cite>src</cite> from Zeus to the local path
specified in <cite>dst</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src</strong> (<em>str</em>) – Path of the remote file to be downloaded from Zeus.</p></li>
<li><p><strong>dst</strong> (<em>str</em>) – Local path/name where to copy the file from Zeus.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">zeus</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/users_home/user/file.nc&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/user/file.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="zeus.put">
<code class="sig-prename descclassname">zeus.</code><code class="sig-name descname">put</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">src</span></em>, <em class="sig-param"><span class="n">dst</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/zeus.html#put"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zeus.put" title="Permalink to this definition">¶</a></dt>
<dd><p>Upload a file to Zeus.</p>
<p>Copy a local file specified in <cite>src</cite> to the remote path specified in
<cite>dst</cite> on Zeus.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src</strong> (<em>str</em>) – Path of the local file to be uploaded on Zeus.</p></li>
<li><p><strong>dst</strong> (<em>str</em>) – Path/name where to copy the file on Zeus.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">zeus</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;/home/user/file.nc&#39;</span><span class="p">,</span> <span class="s1">&#39;/users_home/user/file.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="zeus.process">
<code class="sig-prename descclassname">zeus.</code><code class="sig-name descname">process</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">script_name</span></em>, <em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="n">compress</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">frequency</span><span class="o">=</span><span class="default_value">10</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/zeus.html#process"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zeus.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Submit a script on LSF and download the output data.</p>
<p>This function uploads the local script specified in <cite>script_name</cite>,
executes the script on LSF (i.e., bsub &lt; script_name) and downloads the
output specified in <cite>data</cite> once the job is completed.</p>
<p>Output data can be optionally compressed as tar.gz before downloading it.
Job status checking frequency can be adjusted based on the expected job
duration.</p>
<p>The function is non-blocking, which means that other cells in the notebook
can be executed right after this function is started, without needing to
wait for the job to end.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>script_name</strong> (<em>src</em>) – Absolute (local) path of the script to be submitted on LSF.</p></li>
<li><p><strong>data</strong> (<em>src</em>) – Absolute (remote) path of data to be downloaded.</p></li>
<li><p><strong>compress</strong> (<em>bool, optional</em>) – If data downloaded has to be compressed or not (default is False).</p></li>
<li><p><strong>frequency</strong> (<em>int, optional</em>) – Interval for checking job status in seconds (default is 10s).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">zeus</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;/home/user/script.lsf&#39;</span><span class="p">,</span> <span class="s1">&#39;/users_home/user/output.nc&#39;</span><span class="p">,</span>
<span class="go">compress=True, frequency=20)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="zeus.info">
<code class="sig-prename descclassname">zeus.</code><code class="sig-name descname">info</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">jobid</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/zeus.html#info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zeus.info" title="Permalink to this definition">¶</a></dt>
<dd><p>Get status of LSF jobs on Zeus.</p>
<p>This function returns the list of the jobs the user submitted on LSF. If
<cite>jobid</cite> argument is provided then only the status of that particular job
is shown, otherwise all recent jobs will be listed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>jobid</strong> (<em>int, optional</em>) – ID of LSF job.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">zeus</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">zeus</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="zeus.start_dask">
<code class="sig-prename descclassname">zeus.</code><code class="sig-name descname">start_dask</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">project</span></em>, <em class="sig-param"><span class="n">cores</span></em>, <em class="sig-param"><span class="n">memory</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">'Dask-Test'</span></em>, <em class="sig-param"><span class="n">processes</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">queue</span><span class="o">=</span><span class="default_value">'p_short'</span></em>, <em class="sig-param"><span class="n">local_directory</span><span class="o">=</span><span class="default_value">'~/dask-space'</span></em>, <em class="sig-param"><span class="n">interface</span><span class="o">=</span><span class="default_value">'ib0'</span></em>, <em class="sig-param"><span class="n">walltime</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">job_extra</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">env_extra</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">log_directory</span><span class="o">=</span><span class="default_value">'~/dask-space'</span></em>, <em class="sig-param"><span class="n">death_timeout</span><span class="o">=</span><span class="default_value">60</span></em>, <em class="sig-param"><span class="n">n_workers</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/zeus.html#start_dask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zeus.start_dask" title="Permalink to this definition">¶</a></dt>
<dd><p>Start a new Dask cluster on Zeus</p>
<p>This function starts a new Dask scheduler on the cluster front-end node
and a set of worker process on the cluster compute nodes. The function
returns a ready-to-use Dask client object. The arguments defined in the
interface are lent from the Dask Jobqueue interface.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>project</strong> (<em>str</em>) – Accounting string associated with each worker job. Passed to
<cite>#BSUB -P</cite> option.</p></li>
<li><p><strong>cores</strong> (<em>int</em>) – Number of cores for the worker nodes. Passed to <cite>#BSUB -n</cite> option.</p></li>
<li><p><strong>memory</strong> (<em>str</em>) – Total amount of memory per worker job. Passed to <cite>#BSUB -M</cite> option.</p></li>
<li><p><strong>name</strong> (<em>str, optional</em>) – Name of Dask workers. By default set to Dask-test.</p></li>
<li><p><strong>processes</strong> (<em>int, optional</em>) – Cut the job up into this many processes. Good for GIL workloads or for
nodes with many cores. By default, process ~= sqrt(cores) so that the
number of processes and the number of threads per process is roughly
the same.</p></li>
<li><p><strong>queue</strong> (<em>str, optional</em>) – Destination queue for each worker job. Passed to #BSUB -q option. By
default <cite>p_short</cite> queue is used.</p></li>
<li><p><strong>local_directory</strong> (<em>str, optional</em>) – Dask worker local directory for file spilling. By default the folder
<cite>dask-space</cite> in the home directory is used.</p></li>
<li><p><strong>interface</strong> (<em>str, optional</em>) – Network interface like <cite>eth0</cite> or <cite>ib0</cite>. This will be used for the Dask
workers interface. By default <cite>ib0</cite> is used.</p></li>
<li><p><strong>walltime</strong> (<em>str, optional</em>) – Walltime for each worker job in HH:MM. Passed to <cite>#BSUB -W</cite> option. If
not specified the default queue walltime is used.</p></li>
<li><p><strong>job_extra</strong> (<em>list, optional</em>) – List of optional LSF options, for example -x. Each option will be
prepended with the #BSUB prefix.</p></li>
<li><p><strong>env_extra</strong> (<em>list, optional</em>) – Optional commands to add to script before launching worker.</p></li>
<li><p><strong>log_directory</strong> (<em>str, optional</em>) – Directory to use for job scheduler logs. By default the folder
<cite>dask-space</cite> in the home directory is used.</p></li>
<li><p><strong>death_timeout</strong> (<em>float, optional</em>) – Seconds to wait for a scheduler before closing workers (default is 60).</p></li>
<li><p><strong>n_workers</strong> (<em>int, optional</em>) – Number of worker process to startup, i.e. jobs on LSF (default is 1).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A ready-to-use Dask distributed client connected to the scheduler</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dask.distributed.Client</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">zeus</span><span class="o">.</span><span class="n">start_dask</span><span class="p">(</span>
<span class="go">          project=&quot;R000&quot;,</span>
<span class="go">          cores=36,</span>
<span class="go">          memory=&quot;50 GB&quot;,</span>
<span class="go">          name=&quot;Test&quot;,</span>
<span class="go">          processes=12,</span>
<span class="go">          local_directory=&quot;~/dask-space&quot;,</span>
<span class="go">          interface=&quot;ib0&quot;,</span>
<span class="go">          walltime=&quot;00:30&quot;,</span>
<span class="go">          job_extra=[&quot;-x&quot;],</span>
<span class="go">          n_workers=1</span>
<span class="go">         )</span>
<span class="go">Create a new cluster with a single worker on a whole Zeus node, using 12</span>
<span class="go">processes (3 threads/process), 50GB of RAM memory</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="zeus.stop_dask">
<code class="sig-prename descclassname">zeus.</code><code class="sig-name descname">stop_dask</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">client</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/zeus.html#stop_dask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zeus.stop_dask" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop a running Dask cluster on Zeus</p>
<p>This function stops a running Dask scheduler on the cluster, both
scheduler and worker processes. Note that this function will stop every
Dask cluster running under the provided username on Zeus.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>client</strong> (<em>dask.distributed.Client, optional</em>) – Optional Dask Client refering to a running Dask cluster</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">zeus</span><span class="o">.</span><span class="n">stop_dask</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/zap.png" alt="Logo"/>
            </a></p>
<h3><a href="index.html">Table of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">Zapata</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="interp.html">interp module</a></li>
<li class="toctree-l2"><a class="reference internal" href="klus.html">klus package</a></li>
<li class="toctree-l2"><a class="reference internal" href="zapata.html">zapata package</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">zeus module</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="zapata.work_in_progress.html"
                        title="previous chapter">zapata.work_in_progress module</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/zeus.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="zapata.work_in_progress.html" title="zapata.work_in_progress module"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CMCC-Applications 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="modules.html" >Zapata</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">zeus module</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, AN.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>